#!/bin/dash
directory=$HOME/pictures/screenshots/$(date +%Y)/$(date +%m)/$(date +%d)/
filename=$directory/$(date +%H:%M:%S.%s).png
if  echo "$@" | egrep -w "\-s" ; then
        command="xscreenshot | ff-crop $(slop -f '%x %y %w %h')"
elif echo "$@" | egrep -w "\-w"; then
        window_id=$(xdotool getmouselocation --shell | grep WINDOW | sed 's/WINDOW=//g')
        command="xscreenshot $window_id"
else
        command="xscreenshot"
fi
mkdir -p $directory
eval "$command | ff2png > $filename"
if echo "$@" | egrep -w "\-u"; then
    name=$(date +%s.png)
    url=$(cat $filename | ssh paste "cat > /var/www/website/paste/screenshots/$name"; echo https://desolate.k.vu/paste/screenshots/$name)
    echo $url|xsel -bpsi
    exiftool -overwrite_original -url=$url $filename
    xsetroot -name "File $filename uploaded to $url."
    sleep 2s
    $HOME/.Xsetroot.sh 
fi
